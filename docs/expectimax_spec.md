# Expectimax 設計メモ

## ノード定義
- MAX ノード: プレイヤーの手 (action 0-3)
- CHANCE ノード: タイル生成
  - 空きセルを一様に選択
  - 値は 2 (0.9), 4 (0.1)

## 深さ定義
- depth は MAX ノード回数
- CHANCE ノードでは depth を減らさない

## サンプリング戦略
- 空きセルが多い場合は max_cells でサンプリング
- 一様サンプルで期待値を近似

## 評価関数 (evaluate)
- 空きマス数 (多いほど良い)
- 最大タイル値 (大きいほど良い)
- 単調性 (行・列の単調性スコアを合算)
- 平滑性 (隣接セルの log2 差が小さいほど高評価)
- 重みは dict で管理

## env.step を探索内部で使わない理由
- env.step は移動と spawn をまとめて行うため、CHANCE ノードを明示的に展開できない
- そのため探索では move と spawn を分離し、CHANCE は自前で展開する
